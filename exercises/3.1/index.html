



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="SANS SEC522 Electronic Workbook">
      
      
      
        <meta name="author" content="Jason Lam & Dr. Johannes Ullrich">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.3">
    
    
      
        <title>3.1: Authentication - SEC522 Workbook</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CSource+Code+Pro&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/pdf.css">
    
      <link rel="stylesheet" href="../../css/html.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
      <link rel="stylesheet" href="../../css/jquery.fancybox.min.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#authentication-exercise" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="SEC522 Workbook" aria-label="SEC522 Workbook" class="md-header-nav__button md-logo">
          
            <i class="md-icon">home</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              SEC522 Workbook
            </span>
            <span class="md-header-nav__topic">
              
                3.1: Authentication
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="SEC522 Workbook" class="md-nav__button md-logo">
      
        <i class="md-icon">home</i>
      
    </a>
    SEC522 Workbook
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Welcome!" class="md-nav__link">
      Welcome!
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2" type="checkbox" id="nav-1-2">
    
    <label class="md-nav__link" for="nav-1-2">
      Course
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-2">
        Course
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../resources/preparation/" title="Preparation" class="md-nav__link">
      Preparation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-3" type="checkbox" id="nav-1-3">
    
    <label class="md-nav__link" for="nav-1-3">
      Errata & Patches
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-3">
        Errata & Patches
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../errata/H01_01/" title="H01_01" class="md-nav__link">
      H01_01
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Day 1
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Day 1
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../1.1/" title="1.1: HTTP Basics" class="md-nav__link">
      1.1: HTTP Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1.2/" title="1.2: Inspecting HTTP/2 Traffic" class="md-nav__link">
      1.2: Inspecting HTTP/2 Traffic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1.3/" title="1.3: Isolation" class="md-nav__link">
      1.3: Isolation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1.4/" title="1.4: SSRF and Credential Stealing" class="md-nav__link">
      1.4: SSRF and Credential Stealing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Day 2
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Day 2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../2.1/" title="2.1: SQL Injection" class="md-nav__link">
      2.1: SQL Injection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.2/" title="2.2: Guestbook CSRF" class="md-nav__link">
      2.2: Guestbook CSRF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.3/" title="2.3: Cross-Site Scripting" class="md-nav__link">
      2.3: Cross-Site Scripting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.4/" title="2.4: Unicode and File Upload" class="md-nav__link">
      2.4: Unicode and File Upload
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Day 3
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Day 3
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        3.1: Authentication
      </label>
    
    <a href="./" title="3.1: Authentication" class="md-nav__link md-nav__link--active">
      3.1: Authentication
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part-1" class="md-nav__link">
    Part 1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2" class="md-nav__link">
    Part 2:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-3" class="md-nav__link">
    Part 3:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-0-simple-user-agent-based-authentication" class="md-nav__link">
    Part 0:  Simple User-Agent-Based Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-by-step-instructions" class="md-nav__link">
    Step-by-Step Instructions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-more-complex-but-still-weak-authentication" class="md-nav__link">
    Part 2: More Complex, But Still Weak, Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3-brute-forcing" class="md-nav__link">
    Part 3: Brute Forcing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4-u2f-and-bypassing-2nd-factor" class="md-nav__link">
    Part 4: U2F And Bypassing 2nd Factor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-hints" class="md-nav__link">
    No Hints
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step" class="md-nav__link">
    Step by Step
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explore-further" class="md-nav__link">
    Explore Further
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.2/" title="3.2: Session Fixation and Session Breaking" class="md-nav__link">
      3.2: Session Fixation and Session Breaking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.3/" title="3.3: OAuth and Access Control" class="md-nav__link">
      3.3: OAuth and Access Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.4/" title="3.4: Inspecting SSL Traffic" class="md-nav__link">
      3.4: Inspecting SSL Traffic
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Day 4
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Day 4
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../4.1/" title="4.1: WSDL Enumeration and Parameter Tampering" class="md-nav__link">
      4.1: WSDL Enumeration and Parameter Tampering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.2/" title="4.2: Cross Origin Requests" class="md-nav__link">
      4.2: Cross Origin Requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.3/" title="4.3: Front End Features and Content Security Policy" class="md-nav__link">
      4.3: Front End Features and Content Security Policy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.4/" title="4.4: Clickjacking" class="md-nav__link">
      4.4: Clickjacking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Day 5
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Day 5
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../5.1/" title="5.1: Deserialization and DNS Rebinding" class="md-nav__link">
      5.1: Deserialization and DNS Rebinding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.2/" title="5.2: GraphQL" class="md-nav__link">
      5.2: GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.3/" title="5.3: Microservices" class="md-nav__link">
      5.3: Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.4/" title="5.4: Sub Resource Integrity and Logging" class="md-nav__link">
      5.4: Sub Resource Integrity and Logging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      SANS Cloud Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        SANS Cloud Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://www.sans.org/blog/sans-cloud-security-curriculum/" title="Website" class="md-nav__link">
      Website
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Troubleshooting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Troubleshooting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/common/" title="Common Issues" class="md-nav__link">
      Common Issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/credential-guard/" title="VMware Workstation/Credential Guard Incompatibility" class="md-nav__link">
      VMware Workstation/Credential Guard Incompatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/hyper-v/" title="VMware Workstation/Hyper-V Incompatibility" class="md-nav__link">
      VMware Workstation/Hyper-V Incompatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/bigsur-fusion/" title="VMware Fusion Issues with macOS 11 (Big Sur)" class="md-nav__link">
      VMware Fusion Issues with macOS 11 (Big Sur)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/intel-amd-bios-vtx/" title="Enabling Virtualization Technology Extensions (VTx) in Intel and AMD BIOS" class="md-nav__link">
      Enabling Virtualization Technology Extensions (VTx) in Intel and AMD BIOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/smb-file-sharing/" title="Windows File Sharing Issues" class="md-nav__link">
      Windows File Sharing Issues
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part-1" class="md-nav__link">
    Part 1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2" class="md-nav__link">
    Part 2:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-3" class="md-nav__link">
    Part 3:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-0-simple-user-agent-based-authentication" class="md-nav__link">
    Part 0:  Simple User-Agent-Based Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-by-step-instructions" class="md-nav__link">
    Step-by-Step Instructions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-more-complex-but-still-weak-authentication" class="md-nav__link">
    Part 2: More Complex, But Still Weak, Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3-brute-forcing" class="md-nav__link">
    Part 3: Brute Forcing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4-u2f-and-bypassing-2nd-factor" class="md-nav__link">
    Part 4: U2F And Bypassing 2nd Factor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-hints" class="md-nav__link">
    No Hints
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step" class="md-nav__link">
    Step by Step
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explore-further" class="md-nav__link">
    Explore Further
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <style>
@page { @top-center {
    content: 'SANS SEC522 Workbook';
}}
@page :left { @bottom-left {
  content: '3.1-' counter(page);
}}
@page :right { @bottom-right {
  content: '3.1-' counter(page);
}}
</style>

<h1 id="authentication-exercise">Authentication Exercise</h1>
<hr />
<h4 id="objectives">Objectives</h4>
<div class="codehilite"><pre><span></span><code>Estimated Time: 22 minutes
</code></pre></div>

<h5 id="part-1">Part 1:</h5>
<blockquote>
<p>In this exercise, we will experiment with different examples of weak authentication and demonstrate how to break them.</p>
</blockquote>
<h5 id="part-2">Part 2:</h5>
<blockquote>
<p>In this exercise, we will experiment with different examples of weak authentication and demonstrate how to break them.</p>
</blockquote>
<h5 id="part-3">Part 3:</h5>
<blockquote>
<p>In this exercise, you will walk through the use of U2F (Universal Two-Factor) tokens for two factor authentication. We use a software simulation of a token (softu2f). After registering and testing the token, we will experiment with a method to bypass the use of the token.</p>
</blockquote>
<h4 id="requirements">Requirements</h4>
<ul>
<li>[x] Lab VM</li>
</ul>
<hr />
<h2 id="part-0-simple-user-agent-based-authentication">Part 0:  Simple User-Agent-Based Authentication</h2>
<h3 id="step-by-step-instructions">Step-by-Step Instructions</h3>
<ol>
<li>
<p>Use Chrome to proceed to <a href="http://lab-3.1.sans.labs/uaauth.php"><strong>http://lab-3.1.sans.labs/uaauth.php</strong></a>. The page will indicate that you are using the wrong browser.</p>
</li>
<li>
<p>Start Burp and configure Chrome to use Burp via the Proxy Switcher plugin.</p>
</li>
<li>
<p>Check to make sure interception is on in Burp ("Proxy" -&gt;"Intercept" -&gt; "Intercept is on").</p>
</li>
<li>
<p>Reload the page in the browser.</p>
</li>
<li>
<p>The request will now be held by Burp. Use Burp to modify the request and change the User-Agent to "CatBrowser".</p>
</li>
<li>
<p>Click "Forward" in Burp. The modified request will now be sent, and Chrome should display the page with a thank you statement for using the SANS browser.</p>
</li>
</ol>
<p>The response should provide the necessary information for you to solve the challenge in NetWars. As usual, hints is available via NetWars if necessary.</p>
<hr />
<h2 id="part-2-more-complex-but-still-weak-authentication">Part 2: More Complex, But Still Weak, Authentication</h2>
<ol>
<li>
<p>Ensure that the Chrome is set to sending all browser traffic through Burp - the ProxySwitcher in Chrome should be "red" in color.</p>
</li>
<li>
<p>Open <a href="http://lab-3.1.sans.labs/ua2auth.php">http://lab-3.1.sans.labs/ua2auth.php</a> in Chrome. </p>
</li>
<li>
<p>Switch over to Burp and allow all traffic to pass without modification. Keep clicking on "<strong>Forward</strong>" in Burp's Proxy Intercept. This page looks just like the page we examined in the exercise above but there seems to be some subtle difference.</p>
</li>
<li>
<p>To inspect this previous request, in Burp, we change over to the "<strong>Target</strong>" tab.</p>
</li>
<li>
<p>Look for the most request to "ua2auth.php" and click on it. At the bottom pane of the Burp window is the response details. Due to the window sizing, you might have to adjust the pane to let the response be visible. There is the "three dots symbol" that allow you to adjust the pane sizes. In the response section, you will see the browser cookie being set by the server. We will need to get rid of this cookie in order to get to the website.</p>
<p><img alt="" class="zoom" src="media/img-1615789856-20210315.png" /></p>
</li>
<li>
<p>Switch back to Chrome and reload the page.</p>
</li>
<li>
<p>The request will now be held by Burp. Use Burp to modify the request and change the User-Agent to "DOGBrowser" and also to delete the cookie line. Make sure there are no blank lines in between the HTTP headers. </p>
</li>
<li>
<p>Click "Forward" for all the following requests. You will then see the protected page.</p>
</li>
</ol>
<details class="question">
<summary>What trick did the developer play to harden the page? Was it sufficient?</summary>
<p>The developer coded the authentication such that when the "wrong" browser connect to the webpage, the application provides a cookie to the browser so that the application can reference the use of "wrong" browser in subsequent requests. </p>
</details>
<hr />
<h2 id="part-3-brute-forcing">Part 3: Brute Forcing</h2>
<p>This is an additional challenge exercise on authentication building on the knowledge you acquired so far. This exercise is to simulate a registration system where there is personal information being stored.</p>
<ol>
<li>
<p>Configure Chrome to bypass the Burp proxy via the Proxy Switcher plugin. The icon should be black in color.</p>
</li>
<li>
<p>Browse to <a href="http://lab-3.1.sans.labs/donations.php">http://lab-3.1.sans.labs/donations.php</a></p>
<p>The page has a lookup system where the user can review their own respective donation information. The objective is to acquire as much information from this system as possible.</p>
<p>Use the following hints to help you:</p>
<details class="hint">
<summary>Hint #1</summary>
<p>What's the likely user-agent for "DOGBrowser"? </p>
</details>
<details class="hint">
<summary>Hint #1</summary>
<p>What's the purpose of the cookie "browser"? </p>
</details>
<details class="hint">
<summary>Hint #2</summary>
<p>Can you brute force the donation number? Scripting may help.</p>
</details>
<details class="hint">
<summary>Hint #3</summary>
<p>You can use the "Intruder" feature in Burp to assist with brute forcing the solution.</p>
</details>
</li>
<li>
<p>The page asks for a donation ID. Guess one (maybe 1) and click "Send". The server does not seem to respond to this. </p>
</li>
<li>
<p>Let's inspect it in details. Configure Chrome to use Burp proxy via the Proxy Switcher and then reload the page.</p>
</li>
<li>
<p>In the Burp intercept window, edit the request so that the User-Agent in the request is "DOGBrowser". Also eliminate the <strong>browser=wrong</strong> cookie by deleting it.</p>
<p><img alt="" class="zoom" src="media/img-1615961787-20210317.png" /></p>
</li>
<li>
<p>The system should indicatet that the ID does not exist. You still need to guess a donation ID. There are different ways to do this. We will use Burp in this example.</p>
</li>
<li>
<p>Select the Proxy-&gt;HTTP history tab in Burp and right-click on the last request for donations.php</p>
<p><img alt="" class="zoom" src="media/img-1615961937-20210317.png" /></p>
</li>
<li>
<p>Send Request to Intruder</p>
</li>
<li>
<p>Select "Send to Intruder".</p>
</li>
<li>
<p>Click on the "Intruder" tab (it should now be highlighted in orange).</p>
</li>
<li>
<p>Select the "Positions" tab.</p>
</li>
<li>
<p>Click the "Clear §" button. This will clear the auto-selected payload positions.</p>
</li>
<li>
<p>Highlight the digit after <strong>donationid=</strong>, and click the "Add §" button. This will mark the digits for brute forcing. Also, verify the User-Agent ("DOGBrowser") and make sure the "Browser=wrong" cookie is removed.</p>
<p><img alt="" class="zoom" src="media/img-1615962113-20210317.png" /></p>
<p><strong>Marking Position for Intruder</strong></p>
</li>
<li>
<p>Select the "Payloads" tab.</p>
</li>
<li>
<p>Select "Numbers" from the Payload type dropdown (you may have to scroll down).</p>
</li>
<li>
<p>Select "1" as "From", 100 as "To" , "1" as "Step" and 0 as maximum fraction digits (do not select a larger range, as the Burp Community Edition does rate-limit these requests).</p>
</li>
<li>
<p>Click "Start attack" and acknowledge the restrictions of the community edition.</p>
</li>
<li>
<p>You do not have to wait for the attack to finish. Look for requests with unusual values in the "Length" column and click on them. The larger responses are the ones we are interested in. Select the "Response" and "Render" tab at the bottom to review the response. For successful requests, you should see personal information displayed as part of the response. Request 6 and 17 (and many others) will show positive results. You may need to scroll up in the result window to see the early responses.</p>
<p><img alt="" class="zoom" src="media/img-1615962378-20210317.png" /></p>
<p><strong>Intruder Result</strong></p>
</li>
</ol>
<hr />
<h2 id="part-4-u2f-and-bypassing-2nd-factor">Part 4: U2F And Bypassing 2<sup>nd</sup> Factor</h2>
<h3 id="no-hints">No Hints</h3>
<p>Start at <a href="https://lab-3.1.sans.labs/login.php">https://lab-3.1.sans.labs/login.php</a> . Click "Reset U2F Data". Next log in and follow the instructions to setup the token. Once you setup and verified that the token is working: Try to reach the "myaccount.php" without using the token (just use the username and password).</p>
<h3 id="step-by-step">Step by Step</h3>
<ol>
<li>
<p>Open <a href="https://lab-3.1.sans.labs/login.php">https://lab-3.1.sans.labs/login.php</a> in Google Chrome.</p>
</li>
<li>
<p>Click on "Reset U2F Data" (lower left corner of the page).</p>
</li>
<li>
<p>Login using the username "sec522" and the password "training". You will see a popup at the top of the browser asking you to "Approve" the use of the virtual U2F token.</p>
<p><img alt="" src="media/image4.png" /></p>
<p><strong>U2F Dialog</strong></p>
</li>
<li>
<p>Click "approve". You will now be redirected to the "My Account" page at <a href="https://lab-3.1.sans.labs/myaccount.php">https://lab-3.1.sans.labs/myaccount.php</a></p>
</li>
<li>
<p>Click on "Log Out". You will be redirected to the login page.</p>
<div class="admonition information">
<p class="admonition-title">Information</p>
<p>At this point, we have registered a token with the server. There is a key pair generated and the server is storing the key information so that it can be used in the futue to authenticate the user when the user login. </p>
<p>You may have noticed that you have to click on the token approval earlier. This is a design of Fido2 compatible tokens (whether it's the Android OS, iOS, keyfobs) they all require explicit user approval to avoid accidental and unintentional approvals.</p>
</div>
</li>
<li>
<p>Login again using username "sec522" and password "training".</p>
</li>
<li>
<p>Again, you will be asked to approve the use of the U2F token</p>
</li>
<li>
<p>You are now reaching the "My Account" page.</p>
<p>So far, you learned how to use a U2F token. For a physical token, you would have to pres a button instead of clicking "Approve". Next, we will learn how to bypass the token request.</p>
</li>
<li>
<p>Click "Log Out" again.</p>
</li>
<li>
<p>Verify that you are actually logged out: Try to open <a href="https://lab-3.1.sans.labs/myaccount.php">https://lab-3.1.sans.labs/myaccount.php</a> in the browser. You will be redirected to the login page.</p>
</li>
<li>
<p>Login using the username "sec522" and the password "training". You will be prompted for the U2F token again.</p>
</li>
<li>
<p>Decline the U2F token request, deny the U2F token and cancel the browser's authentication prompt. </p>
</li>
<li>
<p>Open <a href="https://lab-3.1.sans.labs/myaccount.php">https://lab-3.1.sans.labs/myaccount.php</a> in Chrome. You will be able to access the page. You just accessed the "My Account" page without using the U2F token, bypassing the two-factor authentication requirement.</p>
<p>The application logged you in after you entered the username and password. This often happens if the U2F authentication is added later. A better solution would not associate the users user id with the session until the U2F process is complete, or set a flag with the session that the U2F authentication has not yet completed.</p>
<details class="bug">
<summary>If all else fails</summary>
<p>This exercise required the use of a Linux U2F token software for authentication, this is used in lieu of a real Fido2 token (Fido2 is backward compatible with U2F). If resetting of the token software is need, please run the following command in the terminal window.</p>
<div class="codehilite"><pre><span></span><code>systemctl --user restart softu2f
</code></pre></div>

</details>
</li>
</ol>
<hr />
<h2 id="conclusion">Conclusion</h2>
<ul>
<li>There are various ways to authenticate users and some are more secure than others</li>
<li>Authentication needs to be based on 1. something you know 2. something you have 3. something you are; or a combination of those three things. Authentication would be insecure if the data it is relied upon can easily be forged.</li>
</ul>
<hr />
<h2 id="explore-further">Explore Further</h2>
<ul>
<li>Explore <a href="https://webauthn.me/debugger">https://webauthn.me/debugger</a> for WebAuthn and Fido2</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../2.4/" title="2.4: Unicode and File Upload" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                2.4: Unicode and File Upload
              </span>
            </div>
          </a>
        
        
          <a href="../3.2/" title="3.2: Session Fixation and Session Breaking" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                3.2: Session Fixation and Session Breaking
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            ©2021 Jason Lam & Dr. Johannes Ullrich
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/jquery-3.4.1.min.js"></script>
      
        <script src="../../js/jquery.fancybox.min.js"></script>
      
        <script src="../../js/workbook.js"></script>
      
        <script src="../../js/custom.js"></script>
      
    
  </body>
</html>