



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="SANS SEC522 Electronic Workbook">
      
      
      
        <meta name="author" content="Jason Lam & Dr. Johannes Ullrich">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.3">
    
    
      
        <title>Index 2 - SEC522 Workbook</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CSource+Code+Pro&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/pdf.css">
    
      <link rel="stylesheet" href="../../../css/html.css">
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
      <link rel="stylesheet" href="../../../css/jquery.fancybox.min.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#oauth-and-access-control" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="SEC522 Workbook" aria-label="SEC522 Workbook" class="md-header-nav__button md-logo">
          
            <i class="md-icon">home</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              SEC522 Workbook
            </span>
            <span class="md-header-nav__topic">
              
                Index 2
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="SEC522 Workbook" class="md-nav__button md-logo">
      
        <i class="md-icon">home</i>
      
    </a>
    SEC522 Workbook
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="Welcome!" class="md-nav__link">
      Welcome!
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2" type="checkbox" id="nav-1-2">
    
    <label class="md-nav__link" for="nav-1-2">
      Course
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-2">
        Course
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../resources/preparation/" title="Preparation" class="md-nav__link">
      Preparation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-3" type="checkbox" id="nav-1-3">
    
    <label class="md-nav__link" for="nav-1-3">
      Errata & Patches
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-3">
        Errata & Patches
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../errata/G02_01/" title="G02_01" class="md-nav__link">
      G02_01
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Day 1
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Day 1
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../1.1/" title="1.1: HTTP Basics" class="md-nav__link">
      1.1: HTTP Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../1.2/" title="1.2: Inspecting HTTP/2 Traffic" class="md-nav__link">
      1.2: Inspecting HTTP/2 Traffic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../1.3/" title="1.3: Isolation" class="md-nav__link">
      1.3: Isolation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../1.4/" title="1.4: SSRF and Credential Stealing" class="md-nav__link">
      1.4: SSRF and Credential Stealing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Day 2
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Day 2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2.1/" title="2.1: SQL Injection" class="md-nav__link">
      2.1: SQL Injection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2.2/" title="2.2: Guestbook CSRF" class="md-nav__link">
      2.2: Guestbook CSRF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2.3/" title="2.3: Cross-Site Scripting" class="md-nav__link">
      2.3: Cross-Site Scripting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2.4/" title="2.4: Unicode and File Upload" class="md-nav__link">
      2.4: Unicode and File Upload
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Day 3
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Day 3
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../3.1/" title="3.1: Authentication" class="md-nav__link">
      3.1: Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3.2/" title="3.2: Session Fixation and Session Breaking" class="md-nav__link">
      3.2: Session Fixation and Session Breaking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="3.3: OAuth and Access Control" class="md-nav__link">
      3.3: OAuth and Access Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3.4/" title="3.4: Inspecting SSL Traffic" class="md-nav__link">
      3.4: Inspecting SSL Traffic
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Day 4
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Day 4
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../4.1/" title="4.1: WSDL Enumeration and Parameter Tampering" class="md-nav__link">
      4.1: WSDL Enumeration and Parameter Tampering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../4.2/" title="4.2: Cross Origin Requests" class="md-nav__link">
      4.2: Cross Origin Requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../4.3/" title="4.3: Front End Features and Content Security Policy" class="md-nav__link">
      4.3: Front End Features and Content Security Policy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../4.4/" title="4.4: Clickjacking" class="md-nav__link">
      4.4: Clickjacking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Day 5
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Day 5
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../5.1/" title="5.1: Deserialization and DNS Rebinding" class="md-nav__link">
      5.1: Deserialization and DNS Rebinding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../5.2/" title="5.2: GraphQL" class="md-nav__link">
      5.2: GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../5.3/index.md" title="5.3: Microservices" class="md-nav__link">
      5.3: Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../5.4/" title="5.4: Sub Resource Integrity and Logging" class="md-nav__link">
      5.4: Sub Resource Integrity and Logging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      SANS Cloud Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        SANS Cloud Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://www.sans.org/blog/sans-cloud-security-curriculum/" title="Website" class="md-nav__link">
      Website
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Troubleshooting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Troubleshooting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../troubleshooting/common/" title="Common Issues" class="md-nav__link">
      Common Issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../troubleshooting/credential-guard/" title="VMware Workstation/Credential Guard Incompatibility" class="md-nav__link">
      VMware Workstation/Credential Guard Incompatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../troubleshooting/hyper-v/" title="VMware Workstation/Hyper-V Incompatibility" class="md-nav__link">
      VMware Workstation/Hyper-V Incompatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../troubleshooting/bigsur-fusion/" title="VMware Fusion Issues with macOS 11 (Big Sur)" class="md-nav__link">
      VMware Fusion Issues with macOS 11 (Big Sur)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../troubleshooting/intel-amd-bios-vtx/" title="Enabling Virtualization Technology Extensions (VTx) in Intel and AMD BIOS" class="md-nav__link">
      Enabling Virtualization Technology Extensions (VTx) in Intel and AMD BIOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../troubleshooting/smb-file-sharing/" title="Windows File Sharing Issues" class="md-nav__link">
      Windows File Sharing Issues
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part-1" class="md-nav__link">
    Part 1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2" class="md-nav__link">
    Part 2:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-access-control" class="md-nav__link">
    Part 1: Access Control
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-hints" class="md-nav__link">
    No Hints
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step" class="md-nav__link">
    Step by Step
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-oauth" class="md-nav__link">
    Part 2: OAuth
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-hints_1" class="md-nav__link">
    No Hints
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step_1" class="md-nav__link">
    Step by Step
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explore-further" class="md-nav__link">
    Explore Further
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <style>
@page { @top-center {
    content: 'SANS SEC522 Workbook';
}}
@page :left { @bottom-left {
  content: '3.3-' counter(page);
}}
@page :right { @bottom-right {
  content: '3.3-' counter(page);
}}
</style>

<script>
fetch('https://lab-3.3.sans.labs:80');
</script>

<h1 id="oauth-and-access-control">OAuth and Access Control</h1>
<hr />
<h4 id="objectives">Objectives</h4>
<p>Estimated Time: 15 minutes</p>
<h5 id="part-1">Part 1:</h5>
<blockquote>
<p>We learned that for web applications, it is important to apply access control consistently throughout the entire application. In this exercise, we are examining a flaw that allows regular users to perform administrative functions. To explore this flaw, we first execute these actions as administrator to learn what is possible and then later try to replay these actions as a normal user.</p>
</blockquote>
<h5 id="part-2">Part 2:</h5>
<blockquote>
<p>In this exercise, you will walk through an OAuth authentication and later demonstrate how this application does not secure its OAuth tokens successfully</p>
</blockquote>
<h4 id="requirements">Requirements</h4>
<ul>
<li>[x] Lab VM</li>
</ul>
<hr />
<h2 id="part-1-access-control">Part 1: Access Control</h2>
<h3 id="no-hints">No Hints</h3>
<p>Open <a href="http://lab-3.3.sans.labs/index.php">http://lab-3.3.sans.labs/index.php</a> in a browser. Feel free to explore on your own at this point. An administrator is able to adjust the status of an animal in the shelter (for example, flip the "Cat Aggressive" status) by clicking on the respective icon in the page describing an individual animal. Try to perform this action as a normal user. Admin username/pass is sec522/training and regular user is hackercat/training</p>
<h3 id="step-by-step">Step by Step</h3>
<ol>
<li>
<p>Open <a href="http://lab-3.3.sans.labs/index.php">http://lab-3.3.sans.labs/index.php</a> in Chrome.</p>
</li>
<li>
<p>Click the "Login" button (upper right hand corner). This will direct you to our animal shelter login page.</p>
</li>
<li>
<p>Log in as an administrator (username: sec522, password: training). You will see a list of animals up for adoption.</p>
</li>
<li>
<p>Click on an animal's image (for example, the first cat, "Cinnamon"). This will display a page with details about this particular animal.</p>
</li>
<li>
<p>Bellow the image, you will see three icons. Click on one of the icons and it will change color from green to red (or red to green if it was red).</p>
<p><img alt="" src="../media/image1.png" /></p>
<p><strong>Image of Individual Animal with Icons Indicating Status</strong></p>
</li>
<li>
<p>Click on the "Log Out" link (upper right hand corner).</p>
</li>
<li>
<p>Click on the "Login again" link.</p>
</li>
<li>
<p>Log in as a normal user (username: hackercat, password: training).</p>
</li>
<li>
<p>Click on an animal.</p>
</li>
<li>
<p>Verify that clicking on the animal's "status icons" does nothing.</p>
</li>
<li>
<p>Click on the "Log Out" link (upper right hand corner).</p>
</li>
<li>
<p>Click on the "Login again" link.</p>
</li>
<li>
<p>Log in as an administrator (username: sec522, password: training).</p>
<p>Now we will explore what happens when the administrator clicks on one of the status icons.</p>
</li>
<li>
<p>Click on an animal's picture again to end up on the animal's individual page.</p>
</li>
<li>
<p>Open the Google Chrome developer tools by pressing CTRL-Shift-I.</p>
</li>
<li>
<p>Select the "Network" tab in the developer tools.</p>
<p><img alt="" src="../media/image2.png" /></p>
<p><strong>Google Chrome Developer Tools With Network Tab Selected</strong></p>
</li>
<li>
<p>Click on the "Dog" icon to change the animal's "Dog Aggressive" status. This will create a new entry in the developer tool window for "flip.php".</p>
</li>
<li>
<p>Right-click on the "flip.php" entry and select "Copy" -> "Copy as cURL".</p>
<p><img alt="" src="../media/image3.png" /></p>
<p><strong>Copy "flip.php" Request as cURL</strong></p>
</li>
<li>
<p>Open an editor (for example, Visual Studio Code) and paste the request into an empty file.</p>
</li>
<li>
<p>Save the file (recommended name: "test.sh" in the user's home directory, /home/student).</p>
</li>
<li>
<p>Open a terminal.</p>
</li>
<li>
<p>Execute the file:</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span> /home/student/test.sh
</code></pre></div>
<p>Your output will look like.</p>
<p><img alt="" class="zoom" src="../media/img-1615956484-20210317.png" /></p>
<p><strong>Output of test.sh</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The highlighted part in the end <strong>"status":"OK"</strong>. This indicates that the script ran successfully. At this point, you are still logged in as an administrator, and a successful script is what we expect.</p>
</div>
</li>
<li>
<p>Back on Chrome, click the "Log Out" link. </p>
</li>
<li>
<p>Run the script again, just like above:</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span> /home/sec522/test.sh
</code></pre></div>
<p>This time, the output will be an error:</p>
<p><img alt="" class="zoom" src="../media/img-1615956579-20210317.png" /></p>
<p><strong>Terminal Output After Running the Script a Second Time After Logging Out</strong></p>
<p>The script failed this time because "sec522" is no longer logged in, and the cookie included in the prior request in test.sh is no longer valid.</p>
</li>
<li>
<p>Log in as a normal user again (username: hackercat, password: training).</p>
</li>
<li>
<p>Open the "Application" tab in Chrome's Developer Tool. Note that, depending on your screen resolution, this option may be available by clicking on the '>>' symbol in the top right area of the developer tools (see picture below).</p>
<p><img alt="" src="../media/image6.png" /></p>
<p><strong>Opening the Application Tab</strong></p>
</li>
<li>
<p>Next, click on "Cookies" in the left part of the developer menu.</p>
</li>
<li>
<p>Click on "<a href="http://lab-3.3.sans.labs">http://lab-3.3.sans.labs</a>" under "Cookies".</p>
</li>
<li>
<p>Double-click on the "Value" to the right of "sec522_3_3". It will turn blue.</p>
<p><img alt="" class="zoom" src="../media/img-1615956927-20210317.png" /></p>
<p><strong>Highlighting the Cookie Value</strong></p>
</li>
<li>
<p>Right-click on the highlighted value and select "Copy".</p>
</li>
<li>
<p>Open the "test.sh" script you created earlier in your favorite editor. If you are using Visual Studio Code, all you need to do is open the editor and it should automatically open the last edited file.</p>
</li>
<li>
<p>Find the cookie value. It will be the random string after "sec522_3_3=" and replace it with the cookie value you copied from Chrome. Just highlight the old value and "Paste" to overwrite it. If there is a single quote at the end of the session ID, do not delete it.</p>
<p><img alt="" class="zoom" src="../media/img-1615957247-20210317.png" /></p>
<p><strong>Highlighted Cookie Value</strong></p>
</li>
<li>
<p>Exit the editor.</p>
</li>
<li>
<p>Switch back to the terminal.</p>
</li>
<li>
<p>Run the script again. This time, the request should succeed. The figure below shows the terminal with all three requests: first, the one using the administrator's cookie; next, the failed request after the administrator logged out; and finally, the request we just sent with the regular user's cookie, which succeeded as well.</p>
</li>
</ol>
<p>The final request should not have succeeded. This proves that a normal user can execute an administrative request as long as the user knows what request to send.</p>
<p>You may want to now return to the browser to check if the information was changed. You can also make additional edits to the script. Close to the end of the request you should see an "animalid" parameter that can be used to pick different animals. Experiment with it.</p>
<p>Please suggest ways to fix the issues in the applications. You can review the source code of the script at <a href="http://lab-3.3.sans.labs/api/flip.phps">http://lab-3.3.sans.labs/api/flip.phps</a> .</p>
<h2 id="part-2-oauth">Part 2: OAuth</h2>
<h3 id="no-hints_1">No Hints</h3>
<p>The exercise starts at <a href="http://lab-3.3.sans.labs/calendar/index.php">http://lab-3.3.sans.labs/calendar/index.php</a>. The basic steps are explained as part of the website.</p>
<h3 id="step-by-step_1">Step by Step</h3>
<ol>
<li>
<p>The exercise starts at <a href="http://lab-3.3.sans.labs/calendar/index.php">http://lab-3.3.sans.labs/calendar/index.php</a>. The page implements a simple calendar display. But to use it, you need to allow the calendar page to retrieve your calendar from the animal shelter site. Click on the link on the page to be sent to the animal shelter.</p>
</li>
<li>
<p>At the animal shelter, you will need to log in (if you are not already logged in). The username is "sec522", the password is "training".</p>
</li>
<li>
<p>Next, a simple page will ask you for permission to use the calendar. Inspect the URL. It will contain the client_id, which identifies the application requesting access. The "state" variable is used to identify the response returned to the client. Allow access by clicking "yes".</p>
</li>
<li>
<p>You will now be redirected back to the volunteer calendar app and your schedule should appear.</p>
</li>
<li>
<p>Next, click on the "problem" link to learn more about the issue causing authentication tokens to leak.</p>
</li>
<li>
<p>The link already SQL injected the target page. You will now see the vulnerable statement. The "animalname" parameter is injectable, and we can use a union statement to retrieve additional data. The union statement needs to retrieve the same number of columns as the original statement (7). The second column ("animalname") is easily displayed and we will use it for our exploit. Enter as a search:</p>
<div class="admonition warning">
<p class="admonition-title">Important: there is a space after the two dashes '--'.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="err">&#39;</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="mi">1</span><span class="p">,</span><span class="n">access_token</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span> <span class="k">FROM</span> <span class="n">oauth</span><span class="p">.</span><span class="n">oauth_access_tokens</span> <span class="k">LIMIT</span> <span class="mi">1</span> <span class="c1">-- </span>
</code></pre></div>
<p>The token for OAuth authentication (Refresh token) will be displayed below a broken picture on the result page.</p>
</li>
</ol>
<hr />
<h2 id="conclusion">Conclusion</h2>
<ul>
<li>While OAuth can offer secure and reliable authorization between two web sites, the token handling needs to be performed with extreme care. Compromises of tokens can be through other attacks such as SQL injection. Once an attacker acquire the refresh token, the attacker can use the token to get new Access Tokens for further access.</li>
<li>Access control flaws can occur to the most modern applications. Keeping the access controls consistent is the key to successfully defend your application.</li>
</ul>
<hr />
<h2 id="explore-further">Explore Further</h2>
<ul>
<li>Using the acquired refresh token to acquire new access tokens</li>
<li>Are there other refresh tokens inside the database?</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Â©2021 Jason Lam & Dr. Johannes Ullrich
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../js/jquery-3.4.1.min.js"></script>
      
        <script src="../../../js/jquery.fancybox.min.js"></script>
      
        <script src="../../../js/workbook.js"></script>
      
        <script src="../../../js/custom.js"></script>
      
    
  </body>
</html>