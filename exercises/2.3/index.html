



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="SANS SEC522 Electronic Workbook">
      
      
      
        <meta name="author" content="Jason Lam & Dr. Johannes Ullrich">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.3">
    
    
      
        <title>2.3: Cross-Site Scripting - SEC522 Workbook</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CSource+Code+Pro&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/pdf.css">
    
      <link rel="stylesheet" href="../../css/html.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
      <link rel="stylesheet" href="../../css/jquery.fancybox.min.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#exercise-23-cross-site-scripting" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="SEC522 Workbook" aria-label="SEC522 Workbook" class="md-header-nav__button md-logo">
          
            <i class="md-icon">home</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              SEC522 Workbook
            </span>
            <span class="md-header-nav__topic">
              
                2.3: Cross-Site Scripting
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="SEC522 Workbook" class="md-nav__button md-logo">
      
        <i class="md-icon">home</i>
      
    </a>
    SEC522 Workbook
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Course
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Course
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../resources/preparation/" title="Preparation" class="md-nav__link">
      Preparation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Errata & Patches
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Errata & Patches
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../errata/G02/" title="G02" class="md-nav__link">
      G02
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Day 1
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Day 1
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../1.1/" title="1.1: HTTP Basics" class="md-nav__link">
      1.1: HTTP Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1.2/" title="1.2: Inspecting HTTP/2 Traffic" class="md-nav__link">
      1.2: Inspecting HTTP/2 Traffic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1.3/" title="1.3: Isolation" class="md-nav__link">
      1.3: Isolation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1.4/" title="1.4: SSRF and Credential Stealing" class="md-nav__link">
      1.4: SSRF and Credential Stealing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Day 2
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Day 2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../2.1/" title="2.1: SQL Injection" class="md-nav__link">
      2.1: SQL Injection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.2/" title="2.2: Guestbook CSRF" class="md-nav__link">
      2.2: Guestbook CSRF
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        2.3: Cross-Site Scripting
      </label>
    
    <a href="./" title="2.3: Cross-Site Scripting" class="md-nav__link md-nav__link--active">
      2.3: Cross-Site Scripting
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part-1" class="md-nav__link">
    Part 1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2" class="md-nav__link">
    Part 2:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-guestbook-xss-with-csrf" class="md-nav__link">
    Part 1: Guestbook XSS with CSRF
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-hints" class="md-nav__link">
    No Hints
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step" class="md-nav__link">
    Step by Step
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-dom-based-xss-reading-json-feeds-with-datatables" class="md-nav__link">
    Part 2: DOM-Based XSS reading JSON Feeds with DataTables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explore-further" class="md-nav__link">
    Explore Further
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.4/" title="2.4: Unicode and File Upload" class="md-nav__link">
      2.4: Unicode and File Upload
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Day 3
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Day 3
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../3.1/" title="3.1: Authentication" class="md-nav__link">
      3.1: Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.2/" title="3.2: Session Fixation and Session Breaking" class="md-nav__link">
      3.2: Session Fixation and Session Breaking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.3/" title="3.3: OAuth and Access Control" class="md-nav__link">
      3.3: OAuth and Access Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.4/" title="3.4: Inspecting SSL Traffic" class="md-nav__link">
      3.4: Inspecting SSL Traffic
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Day 4
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Day 4
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../4.1/" title="4.1: WSDL Enumeration and Parameter Tampering" class="md-nav__link">
      4.1: WSDL Enumeration and Parameter Tampering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.2/" title="4.2: Cross Origin Requests" class="md-nav__link">
      4.2: Cross Origin Requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.3/" title="4.3: Front End Features and Content Security Policy" class="md-nav__link">
      4.3: Front End Features and Content Security Policy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.4/" title="4.4: Clickjacking" class="md-nav__link">
      4.4: Clickjacking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Day 5
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Day 5
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../5.1/" title="5.1: Deserialization and DNS Rebinding" class="md-nav__link">
      5.1: Deserialization and DNS Rebinding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.2/" title="5.2: GraphQL" class="md-nav__link">
      5.2: GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.3/" title="5.3: Microservices" class="md-nav__link">
      5.3: Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.4/" title="5.4: Sub Resource Integrity and Logging" class="md-nav__link">
      5.4: Sub Resource Integrity and Logging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      SANS Cloud Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        SANS Cloud Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://www.sans.org/blog/sans-cloud-security-curriculum/" title="Website" class="md-nav__link">
      Website
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Troubleshooting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Troubleshooting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/common/" title="Common Issues" class="md-nav__link">
      Common Issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/credential-guard/" title="VMware Workstation/Credential Guard Incompatibility" class="md-nav__link">
      VMware Workstation/Credential Guard Incompatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/hyper-v/" title="VMware Workstation/Hyper-V Incompatibility" class="md-nav__link">
      VMware Workstation/Hyper-V Incompatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/bigsur-fusion/" title="VMware Fusion Issues with macOS 11 (Big Sur)" class="md-nav__link">
      VMware Fusion Issues with macOS 11 (Big Sur)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/intel-amd-bios-vtx/" title="Enabling Virtualization Technology Extensions (VTx) in Intel and AMD BIOS" class="md-nav__link">
      Enabling Virtualization Technology Extensions (VTx) in Intel and AMD BIOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../troubleshooting/smb-file-sharing/" title="Windows File Sharing Issues" class="md-nav__link">
      Windows File Sharing Issues
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part-1" class="md-nav__link">
    Part 1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2" class="md-nav__link">
    Part 2:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-guestbook-xss-with-csrf" class="md-nav__link">
    Part 1: Guestbook XSS with CSRF
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-hints" class="md-nav__link">
    No Hints
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step" class="md-nav__link">
    Step by Step
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-dom-based-xss-reading-json-feeds-with-datatables" class="md-nav__link">
    Part 2: DOM-Based XSS reading JSON Feeds with DataTables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explore-further" class="md-nav__link">
    Explore Further
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <script>
fetch('https://lab-2.3.sans.labs:80');
</script>

<h1 id="exercise-23-cross-site-scripting">Exercise 2.3 - Cross-Site Scripting</h1>
<hr />
<h4 id="objectives">Objectives</h4>
<div class="codehilite"><pre><span></span><code>Estimated Time: 20 minutes
</code></pre></div>

<h5 id="part-1">Part 1:</h5>
<blockquote>
<p>You will learn how to identify XSS and how important it is to check all input fields for XSS. We will also learn how XSS can be abused against a guestbook web application and how XSS may result in CSRF.</p>
</blockquote>
<h5 id="part-2">Part 2:</h5>
<blockquote>
<p>We expanded the animal shelter to allow partners to provide JSON data feeds of adoptable pets. These feeds are rendered using the popular "DataTables" extension to jQuery. Find (and fix) the DOM-based CSS vulnerability.</p>
</blockquote>
<h4 id="requirements">Requirements</h4>
<ul>
<li>[x] Lab VM</li>
</ul>
<h2 id="part-1-guestbook-xss-with-csrf">Part 1: Guestbook XSS with CSRF</h2>
<h3 id="no-hints">No Hints</h3>
<p>Also, for the guestbook at <a href="http://lab-2.3.sans.labs/login.php">http://lab-2.3.sans.labs/login.php</a>, we experimented with this guestbook before. This time find the XSS vulnerability and exploit it to approve posts that an administrator views automatically. (Logins available - sec522/training and admin/admin)</p>
<h3 id="step-by-step">Step by Step</h3>
<p>For this part, we will revisit the guestbook system. The site administrator noticed the CSRF attack and decided to approve every single guestbook entry manually.</p>
<ol>
<li>
<p>Using Chrome, browse to <strong><a href="http://lab-2.3.sans.labs/login.php">http://lab-2.3.sans.labs/login.php</a></strong>. </p>
</li>
<li>
<p>Log in to the guestbook using <strong>"sec522"</strong> and <strong>"training"</strong> as username and password.</p>
<ol>
<li>
<p>Attempt to input two guest entries into the guestbook. The new guestbook requires the administrator to approve the entries before posting them on the page.</p>
</li>
<li>
<p>Log out of the guestbook by clicking on the <strong>"Logout"</strong> link.</p>
</li>
</ol>
</li>
<li>
<p>Log in with username <strong>"admin"</strong> and password <strong>"admin"</strong>. This allows you to log in as an administrator.</p>
<p>Administrative functions are now available. This includes the ability to delete comments and approve messages.</p>
<ol>
<li>
<p>There should be two comments awaiting approval. Please click delete on one of the comments. That comment should then be deleted.</p>
</li>
<li>
<p>There should be one comment left; click the <strong>"Approve All Posts"</strong> button to approve the comment displayed to the public.</p>
</li>
</ol>
</li>
<li>
<p>Log out of the guestbook by clicking on the <strong>"Logout"</strong> link.</p>
</li>
</ol>
<p>The CSRF attack on other users is no longer possible. It would likely not get past the administrator, who will review the comments before allowing the public to see them.</p>
<p><br></p>
<p>Now that we understand how this guestbook system works let's explore if it is vulnerable to attacks.</p>
<ol>
<li>
<p>Log in to the guestbook using <strong>"sec522"</strong> and <strong>"training"</strong> as username and password.</p>
</li>
<li>
<p>Attempt to add one new comment. Put anything as name, email, and URL. For comments, enter the following string:</p>
<div class="highlight"><pre><span></span><code>XSS<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;xss&#39;</span><span class="p">);&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div>
</li>
<li>
<p>Press the <strong>"Add"</strong> button. The message is awaiting administrator approval, as indicated by the message on the response page.</p>
</li>
<li>
<p>Click <strong>"Logout"</strong> then log in with username <strong>"admin"</strong> and password <strong>"admin"</strong>.
   A pop-up box should appear with <strong>"xss"</strong> in it. The input from the user becomes part of the page; the script input becomes rendered in the browser as a script. This is a classic case of stored XSS vulnerability.</p>
</li>
<li>
<p><em>(Optional)</em> Feel free to view the page's source to look for the XSS alert box and see why it became part of the scripting content on the page.</p>
</li>
<li>
<p>Delete the XSS comment in the <strong>"waiting for approval"</strong> section, as this can be annoying since the pop-up box shows up in every page load. Click the <strong>"Delete Message"</strong> link in the XSS comment.</p>
</li>
<li>
<p>Log out of the guestbook by clicking on the <strong>"Logout"</strong> link.</p>
</li>
</ol>
<p>We have now proved the comment field to be vulnerable to XSS attacks. Let's see how we can leverage this vulnerability.</p>
<p>We know there is an XSS vulnerability in the comment field. Anyone looking at that comment will have their browser hijacked to run scripts. Hence, these browsers can be controlled. That is very useful: what if we can control the administrator's browser so that the comments could automatically be approved as soon as an administrator looks at them? This is precisely the subject of the NetWar challenge. Once you exploit the administrator, a flag will appear with the necessary answer. </p>
<p>You will first login to the guestbook as the sec522 user (<strong>"sec522"</strong> and <strong>"training"</strong> as username and password), then submit the crafted XSS+CSRF attack string as part of the submission to the application. Once you submit, you can log out and log back in as administrator (<strong>admin/admin</strong> as the credential) to determine if the attack has worked. There are hints in NetWars to help you craft the attack if necessary. </p>
<div class="admonition info">
<p class="admonition-title">How do we remediate a vulnerability like this?</p>
</div>
<p>To demonstrate a fix for the XSS vulnerability, we have prepared a \"fixed\" version of the guestbook: "guestbook-xss.php." This file is essentially the same as the guestbook.php we have seen, except the XSS in the comment field is fixed.</p>
<p>The htmlentities function in PHP is to used to encode characters such as &lt; &gt;, /, &amp;, \', or \" to HTML entities. For example, "\&lt; becomes "&lt;" and "\&gt;" becomes "&gt;" . When "\&lt; gets sent to the browser, the browser will interpret it as HTML. But when "&lt;" gets sent to the browser, the browser will display the "\&lt; symbol.</p>
<p>One line of example code is below:</p>
<div class="highlight"><pre><span></span><code><span class="x">print htmlentities($r[3]);</span>
</code></pre></div>
<p>Before $r[3] is displayed on-screen, it is encoded.</p>
<p>Feel free to explore the fixed code at <strong><a href="http://lab-2.3.sans.labs/guestbook-xss.phps">http://lab-2.3.sans.labs/guestbook-xss.phps</a></strong> (line 117).</p>
<ol>
<li>
<p>Browse to <a href="http://lab-2.3.sans.labs/guestbook-xss.php">http://lab-2.3.sans.labs/guestbook-xss.php</a>.</p>
</li>
<li>
<p>Look at the comments and explore why there is no longer a broken image sign, but the entire XSS and CSRF string are displayed. Viewing the source of this page gives insight as to why this is no longer treated as an &lt;IMG&gt; tag, but it is considered text on-screen.</p>
</li>
</ol>
<hr />
<h2 id="part-2-dom-based-xss-reading-json-feeds-with-datatables">Part 2: DOM-Based XSS reading JSON Feeds with DataTables</h2>
<ol>
<li>
<p>Browse to <a href="http://lab-2.3.sans.labs/partners.php">http://lab-2.3.sans.labs/partners.php</a> or click the <strong>Partners</strong> link in the header.</p>
</li>
<li>
<p>First, try a "safe" local feed to become familiar with the feature. Enter the following as a URL and click "Preview."</p>
<div class="highlight"><pre><span></span><code>http://lab-2.3.sans.labs/json/good.json
</code></pre></div>
</li>
<li>
<p>Click on the <strong>Click here to Hide or Show the Pet's Name</strong> link to make the animal names column visible, and click again to hide them. This link will display or hide the first column of the table.</p>
</li>
<li>
<p>Load the "evil" feed from a third-party site. Enter the following as the URL and click <strong>Preview</strong>.</p>
<div class="highlight"><pre><span></span><code>http://lab-2.3-evil.sans.labs/json/evil.json
</code></pre></div>
<p>Initially, you will not see any problems (try the sort and filter functions). </p>
</li>
<li>
<p>Display the pet names again by clicking on <strong>Click here to Hide or Show the Pet's Name</strong>. You should now see a popup: "XSS Exploit". Find the record that causes the problem. You may need to sort or search for "cat" to find it.</p>
</li>
<li>
<p>The name of the "exploit pet" starts with <code>XYZ</code>. Right-click over <code>XYZ</code>  and select <code>Inspect</code> to see the exploit. </p>
</li>
<li>
<p>Open the JSON file by loading the URL in a new browser window. Identify the exploit line (note the "animal ID." This will be the answer for the netwars quiz).</p>
</li>
<li>
<p>Open the JavaScript file that renders the table: <a href="http://lab-2.3.sans.labs/js/partner0.js">http://lab-2.3.sans.labs/js/partner0.js</a>. (Click to open in new tab) Become familiar with the code.</p>
</li>
<li>
<p>We will remove the word "script" from the data as a first fix. Click on "Fix 1" to load the page implementing that fix.</p>
</li>
<li>
<p>Load the "evil" JSON feed again.</p>
</li>
<li>
<p>Display the animal names and sort by animal names to see the exploit name at the top. The exploit no longer works.</p>
<p><img alt="" class="zoom" src="media/exercise231.png" /></p>
</li>
<li>
<p>Open the improved JavaScript file
    <code>http://lab-2.3.sans.labs/js/partner1.js</code>
    to become familiar with the <code>render</code> function used to evade the problem:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span> <span class="nx">data</span><span class="o">:</span> <span class="s2">&quot;animalname&quot;</span><span class="p">,</span>
  <span class="c1">// do not allow script tags</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">row</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="s2">&quot;&lt;span id=&quot;</span><span class="o">+</span><span class="nx">row</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s2">&quot;&gt;&quot;</span><span class="o">+</span><span class="nx">data</span><span class="o">+</span><span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">,</span><span class="s1">&#39;s#ript&#39;</span><span class="p">);</span>
     <span class="p">}</span>
<span class="p">},</span>
</code></pre></div>
</li>
<li>
<p>Try another "evil" feed:</p>
<p><code>http://lab-2.3-evil.sans.labs/json/evil2.json</code></p>
<p>This feed evades our simple mitigation. What is the HTML tag used to trigger the JavaScript?</p>
</li>
<li>
<p>We got a better fix! Let's remove all &lt; and &gt; characters. Click on <code>Fix 2</code> to try it out.</p>
</li>
<li>
<p>Looking better? You may review the new JavaScript file here: <code>http://lab-2.3.sans.labs/js/partner2.js</code>. The new render function to go with it:</p>
<div class="highlight"><pre><span></span><code><span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">row</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">data</span> <span class="o">=</span> <span class="s2">&quot;&lt;span id=&quot;</span><span class="o">+</span><span class="nx">row</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s2">&quot;&gt;&quot;</span><span class="o">+</span><span class="nx">data</span><span class="o">+</span><span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="p">;</span>
          <span class="nx">data</span><span class="o">=</span><span class="nx">data</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;lt&#39;</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;gt&#39;</span><span class="p">);</span>
      <span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Notice how the <code>id</code> is used as an HTML attribute. The code is still exploitable. Try to load</p>
<div class="highlight"><pre><span></span><code>http://lab-2.3-evil.sans.labs/json/evil2.json
</code></pre></div>
</li>
<li>
<p>The final fix, you wonder? Click on <code>Fix 3</code>. You may want to inspect the corresponding JavaScript file:</p>
<div class="highlight"><pre><span></span><code>http://lab-2.3.sans.labs/js/partner3.js
</code></pre></div>
</li>
</ol>
<hr />
<h2 id="conclusion">Conclusion</h2>
<ul>
<li>There are multiple variants of the XSS attacks. </li>
<li>XSS is intended to confuse the browser into interrupting certain attacker-controlled Web content as instructions from the Web server. The result isn't the "server" being hacked, but the browser executes some attacker-controlled content.</li>
<li>XSS has to be prevented by properly encoding output. Either as the page is rendered on the server or the browser for DOM-based attacks.</li>
</ul>
<hr />
<h2 id="explore-further">Explore Further</h2>
<ul>
<li>Experiment with partner.js. What if you do not display the name first and turn it on later?</li>
<li>Can you find other vulnerabilities in the "Partner" application (not just XSS)?</li>
<li>edit the JSON file. What other tags work? Iframe?</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../2.2/" title="2.2: Guestbook CSRF" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                2.2: Guestbook CSRF
              </span>
            </div>
          </a>
        
        
          <a href="../2.4/" title="2.4: Unicode and File Upload" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                2.4: Unicode and File Upload
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            ©2021 Jason Lam & Dr. Johannes Ullrich
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/jquery-3.4.1.min.js"></script>
      
        <script src="../../js/jquery.fancybox.min.js"></script>
      
        <script src="../../js/workbook.js"></script>
      
        <script src="../../js/custom.js"></script>
      
    
  </body>
</html>