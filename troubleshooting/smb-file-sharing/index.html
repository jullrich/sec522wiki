



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="SANS SEC522 Electronic Workbook">
      
      
      
        <meta name="author" content="Jason Lam & Dr. Johannes Ullrich">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.3">
    
    
      
        <title>Windows File Sharing Issues - SEC522 Workbook</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CSource+Code+Pro&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/pdf.css">
    
      <link rel="stylesheet" href="../../css/html.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
      <link rel="stylesheet" href="../../css/jquery.fancybox.min.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#windows-file-sharing-issues" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="SEC522 Workbook" aria-label="SEC522 Workbook" class="md-header-nav__button md-logo">
          
            <i class="md-icon">home</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              SEC522 Workbook
            </span>
            <span class="md-header-nav__topic">
              
                Windows File Sharing Issues
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="SEC522 Workbook" class="md-nav__button md-logo">
      
        <i class="md-icon">home</i>
      
    </a>
    SEC522 Workbook
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Welcome!" class="md-nav__link">
      Welcome!
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2" type="checkbox" id="nav-1-2">
    
    <label class="md-nav__link" for="nav-1-2">
      Course
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-2">
        Course
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../resources/preparation/" title="Preparation" class="md-nav__link">
      Preparation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-3" type="checkbox" id="nav-1-3">
    
    <label class="md-nav__link" for="nav-1-3">
      Errata & Patches
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-3">
        Errata & Patches
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../errata/G02_01/" title="G02_01" class="md-nav__link">
      G02_01
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Day 1
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Day 1
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/1.1/" title="1.1: HTTP Basics" class="md-nav__link">
      1.1: HTTP Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/1.2/" title="1.2: Inspecting HTTP/2 Traffic" class="md-nav__link">
      1.2: Inspecting HTTP/2 Traffic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/1.3/" title="1.3: Isolation" class="md-nav__link">
      1.3: Isolation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/1.4/" title="1.4: SSRF and Credential Stealing" class="md-nav__link">
      1.4: SSRF and Credential Stealing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Day 2
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Day 2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/2.1/" title="2.1: SQL Injection" class="md-nav__link">
      2.1: SQL Injection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/2.2/" title="2.2: Guestbook CSRF" class="md-nav__link">
      2.2: Guestbook CSRF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/2.3/" title="2.3: Cross-Site Scripting" class="md-nav__link">
      2.3: Cross-Site Scripting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/2.4/" title="2.4: Unicode and File Upload" class="md-nav__link">
      2.4: Unicode and File Upload
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Day 3
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Day 3
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/3.1/" title="3.1: Authentication" class="md-nav__link">
      3.1: Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/3.2/" title="3.2: Session Fixation and Session Breaking" class="md-nav__link">
      3.2: Session Fixation and Session Breaking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/3.3/" title="3.3: OAuth and Access Control" class="md-nav__link">
      3.3: OAuth and Access Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/3.4/" title="3.4: Inspecting SSL Traffic" class="md-nav__link">
      3.4: Inspecting SSL Traffic
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Day 4
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Day 4
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/4.1/" title="4.1: WSDL Enumeration and Parameter Tampering" class="md-nav__link">
      4.1: WSDL Enumeration and Parameter Tampering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/4.2/" title="4.2: Cross Origin Requests" class="md-nav__link">
      4.2: Cross Origin Requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/4.3/" title="4.3: Front End Features and Content Security Policy" class="md-nav__link">
      4.3: Front End Features and Content Security Policy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/4.4/" title="4.4: Clickjacking" class="md-nav__link">
      4.4: Clickjacking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Day 5
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Day 5
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/5.1/" title="5.1: Deserialization and DNS Rebinding" class="md-nav__link">
      5.1: Deserialization and DNS Rebinding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/5.2/" title="5.2: GraphQL" class="md-nav__link">
      5.2: GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/5.3/" title="5.3: Microservices" class="md-nav__link">
      5.3: Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/5.4/" title="5.4: Sub Resource Integrity and Logging" class="md-nav__link">
      5.4: Sub Resource Integrity and Logging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      SANS Cloud Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        SANS Cloud Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://www.sans.org/blog/sans-cloud-security-curriculum/" title="Website" class="md-nav__link">
      Website
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    
    <label class="md-nav__link" for="nav-8">
      Troubleshooting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Troubleshooting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../common/" title="Common Issues" class="md-nav__link">
      Common Issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../credential-guard/" title="VMware Workstation/Credential Guard Incompatibility" class="md-nav__link">
      VMware Workstation/Credential Guard Incompatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hyper-v/" title="VMware Workstation/Hyper-V Incompatibility" class="md-nav__link">
      VMware Workstation/Hyper-V Incompatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bigsur-fusion/" title="VMware Fusion Issues with macOS 11 (Big Sur)" class="md-nav__link">
      VMware Fusion Issues with macOS 11 (Big Sur)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../intel-amd-bios-vtx/" title="Enabling Virtualization Technology Extensions (VTx) in Intel and AMD BIOS" class="md-nav__link">
      Enabling Virtualization Technology Extensions (VTx) in Intel and AMD BIOS
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Windows File Sharing Issues
      </label>
    
    <a href="./" title="Windows File Sharing Issues" class="md-nav__link md-nav__link--active">
      Windows File Sharing Issues
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#using-uncs-for-smb-sharing" class="md-nav__link">
    Using UNCs for SMB Sharing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-troubleshooting-approach" class="md-nav__link">
    First Troubleshooting Approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-troubleshooting-approaches" class="md-nav__link">
    Additional Troubleshooting Approaches
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-administrator-terminalprompt" class="md-nav__link">
    Running Administrator Terminal/Prompt
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#using-uncs-for-smb-sharing" class="md-nav__link">
    Using UNCs for SMB Sharing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-troubleshooting-approach" class="md-nav__link">
    First Troubleshooting Approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-troubleshooting-approaches" class="md-nav__link">
    Additional Troubleshooting Approaches
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-administrator-terminalprompt" class="md-nav__link">
    Running Administrator Terminal/Prompt
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="windows-file-sharing-issues">Windows File Sharing Issues</h1>
<p>During your class, you may wish to share or copy files between your host system and a virtual machine or between virtual machines.  One method of doing this is to use Microsoft Windows's native file sharing features, known as SMB.  Tools that provide SMB functionality are available for Windows, macOS, and Linux operating systems.  If you wish to use SMB to share files from a Windows client system, you'll need to follow the steps in this document to adjust the security settings.  Using a macOS or Linux client system does not require these measures.</p>
<h2 id="using-uncs-for-smb-sharing">Using UNCs for SMB Sharing</h2>
<p>To connect from one Windows system to another running SMB, you'll use UNC syntax with the destination system's hostname or IP address:</p>
<ul>
<li><code>\\&lt;%DESTINATION_SYSTEM_HOSTNAME%&gt;\</code></li>
<li><code>\\&lt;%DESTINATION_SYSTEM_IP_ADDRESS%&gt;\</code></li>
</ul>
<p><img alt="Accessing SMB server with UNC" src="../img/smb-file-sharing/file-share-address-options.png" title="Accessing SMB server with UNC" /></p>
<p>If, after attempting to access the destination system using both the hostname and IP address UNCs, you receive the following error message, you will need to change your settings on the Microsoft Windows client system to enable SMB functionality.</p>
<p><img alt="Windows cannot access share error message" class="w400" src="../img/smb-file-sharing/win-cannot-access-error.png" title="Windows cannot access share error message" /></p>
<h2 id="first-troubleshooting-approach">First Troubleshooting Approach</h2>
<p>The following PowerShell one-liner is often all that is needed to fix the above error.  Run this command before doing moving forward with any other steps.</p>
<p>Run this command from an <a href="#running-administrator-terminalprompt">Administrator PowerShell Terminal</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">Set-ItemProperty</span> <span class="n">-Path</span> <span class="s2">&quot;HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters&quot;</span> <span class="n">AllowInsecureGuestAuth</span> <span class="n">-Type</span> <span class="n">DWORD</span> <span class="n">-Value</span> <span class="n">1</span> <span class="n">-Force</span>
</code></pre></div>
</div>
<p>If the command runs successfully, no results will be displayed in the PowerShell terminal.</p>
<p>Close and restart Windows Explorer and re-test your connection to file share. If you still receive the error message, see the additional troubleshooting steps below.</p>
<h2 id="additional-troubleshooting-approaches">Additional Troubleshooting Approaches</h2>
<p>If SMB sharing still is not working after running the above PowerShell one-liner, one or more of the following steps may be required.</p>
<ol>
<li>
<p>Verify Lanman Workstation <code>AllowInsecureGuestAuth</code> Setting
    This PowerShell command will display the current Lanman Workstation <code>AllowInsecureGuestAuth</code> registry key.  This MUST be set to <code>1</code> for Windows File Sharing to function.</p>
<p>Run this command from an <a href="#running-administrator-terminalprompt">Administrator PowerShell Terminal</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">Get-ItemProperty</span> <span class="n">-Path</span> <span class="s2">&quot;HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters&quot;</span> <span class="p">|</span> <span class="nb">format-list</span> <span class="n">-property</span> <span class="n">AllowInsecureGuestAuth</span>
</code></pre></div>
<div class="admonition summary">
<p class="admonition-title">Expected Results</p>
<div class="highlight"><pre><span></span><code><span class="gp">PS C:\Users\sansforensics&gt; </span><span class="nb">Get-ItemProperty</span> <span class="n">-Path</span> <span class="s2">&quot;HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters&quot;</span> <span class="p">|</span> <span class="nb">format-list</span> <span class="n">-property</span> <span class="n">AllowInsecureGuestAuth</span>
<span class="go">AllowInsecureGuestAuth : 1</span>
</code></pre></div>
</div>
<p>If this returns a value of <code>0</code> instead, run the PowerShell one-liner in the <a href="#first-troubleshooting-approach">First Troubleshooting Approach</a> section above.</p>
</div>
</li>
<li>
<p>Verify the destination machine's IP address</p>
<p>The network interface name can vary from system to system, and some systems will have more than one interface.  You will need to know which interface is being used for SMB access.  Your TA, SME, or instructor can assist you if you're unsure which interface is being used.</p>
<p>Log in to the destination system.</p>
<ol>
<li>
<p>If the destination system is running Linux:</p>
<div class="admonition tip">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>ip address
</code></pre></div>
<details class="summary"><summary>Notional results</summary><div class="highlight"><pre><span></span><code><span class="go">sansforensics@siftworkstation: ~</span>
<span class="gp">$ </span>ip address
<span class="go">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
<span class="go">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span>
<span class="go">    inet 127.0.0.1/8 scope host lo</span>
<span class="go">    valid_lft forever preferred_lft forever</span>
<span class="go">    inet6 ::1/128 scope host </span>
<span class="go">    valid_lft forever preferred_lft forever</span>
<span class="go">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span>
<span class="go">    link/ether 00:0c:29:3a:47:73 brd ff:ff:ff:ff:ff:ff</span>
<span class="hll"><span class="go">    inet 192.168.107.8/24 brd 192.168.107.255 scope global dynamic noprefixroute ens33</span>
</span><span class="go">    valid_lft 85518sec preferred_lft 85518sec</span>
<span class="go">    inet6 fd15:4ba5:5a2b:1008:35c7:81c:372d:e121/64 scope global temporary dynamic </span>
<span class="go">    valid_lft 604786sec preferred_lft 86054sec</span>
<span class="go">    inet6 fd15:4ba5:5a2b:1008:76b7:6100:3d57:95e9/64 scope global dynamic mngtmpaddr noprefixroute </span>
<span class="go">    valid_lft 2591985sec preferred_lft 604785sec</span>
<span class="go">    inet6 fe80::ceae:7a20:f025:62b6/64 scope link noprefixroute </span>
<span class="go">    valid_lft forever preferred_lft forever</span>
<span class="go">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span>
<span class="go">    link/ether 02:42:24:25:69:75 brd ff:ff:ff:ff:ff:ff</span>
<span class="go">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span>
<span class="go">    valid_lft forever preferred_lft forever</span>
</code></pre></div>
<p>In this case, the interface <code>ens33</code> is the only one used for the VM's services and its IP address is <code>192.168.107.8</code>, indicated by the highlighted line:
<div class="highlight"><pre><span></span><code>inet 192.168.107.8/24 ...
</code></pre></div></p>
</details>
</div>
</li>
<li>
<p>If the destination system is running Windows:</p>
<div class="admonition tip">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="go">ipconfig</span>
</code></pre></div>
<details class="summary"><summary>Notional results</summary><div class="highlight"><pre><span></span><code><span class="gp">C:\Users\sansforensics&gt;</span> ipconfig
<span class="go">Ethernet adapter Ethernet:</span>

<span class="go">Connection-specific DNS Suffix  . : sansgear.com</span>
<span class="go">IPv6 Address. . . . . . . . . . . : fd15:4ba5:5a2b:1008:9c14:e101:232:5a1c</span>
<span class="go">Temporary IPv6 Address. . . . . . : fd15:4ba5:5a2b:1008:8b4:b370:203b:a766</span>
<span class="go">Temporary IPv6 Address. . . . . . : fd15:4ba5:5a2b:1008:a426:af82:6efc:488</span>
<span class="go">Link-local IPv6 Address . . . . . : fe80::9c14:e101:232:5a1c%12</span>
<span class="hll"><span class="go">IPv4 Address. . . . . . . . . . . : 192.168.107.2</span>
</span><span class="go">Subnet Mask . . . . . . . . . . . : 255.255.255.0</span>
<span class="go">Default Gateway . . . . . . . . . : fe80::472:1446:5c3d:7670%12</span>
<span class="go">                                    192.168.107.1</span>
</code></pre></div>
<p>In this case, the IP address is <code>192.168.107.2</code>, indicated by the highlighted line:</p>
<div class="highlight"><pre><span></span><code>IPv4 Address. . . . . . . . . . . : 192.168.107.2
</code></pre></div>
</details>
</div>
</li>
</ol>
</li>
<li>
<p>Allow File and Print Sharing through the firewall</p>
<p>The simplest approach is to turn off the Windows Firewall entirely while you are in the classroom environment.  The following command will accomplish this.</p>
<p>Run this command from an <a href="#running-administrator-terminalprompt">Administrator PowerShell Terminal or Administrator Command Prompt</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="n">netsh</span> <span class="n">advfirewall</span> <span class="nb">set </span><span class="n">allprofiles</span> <span class="n">state</span> <span class="n">off</span>
</code></pre></div>
<details class="summary"><summary>Expected results</summary><div class="highlight"><pre><span></span><code><span class="gp">PS C:\Users\sansforensics&gt; </span><span class="n">netsh</span> <span class="n">advfirewall</span> <span class="nb">set </span><span class="n">allprofiles</span> <span class="n">state</span> <span class="n">off</span>
<span class="go">Ok.</span>
</code></pre></div>
</details>
</div>
<p>To re-enable the firewall after class, run the same command with <code>on</code> instead of <code>off</code>.</p>
<p>If you are not able to disable the firewall completely, you can open only the file and print sharing ports.</p>
<ol>
<li>Open Control Panel, click System and Security, and then click Windows Firewall.</li>
<li>
<p>In the left pane, click Advanced settings, and in the console tree, click Inbound Rules.</p>
<p><a class="zoom" href="../img/smb-file-sharing/firewall-1.png"><img alt="Windows cannot access error message" class="w350" src="../img/smb-file-sharing/firewall-1.png" /></a></p>
</li>
<li>
<p>Under Inbound Rules, locate the rules <code>File and Printer Sharing (NB-Session-In)</code> and <code>File and Printer Sharing (SMB-In)</code>.</p>
<p><a class="zoom" href="../img/smb-file-sharing/firewall-2.png"><img alt="Windows cannot access error message" class="w350" src="../img/smb-file-sharing/firewall-2.png" /></a></p>
</li>
<li>
<p>For each rule, right-click the rule, and then click <code>Enabled</code> checkbox and <code>Allow the connection</code> option. Click the "OK" button.</p>
<p><a class="zoom" href="../img/smb-file-sharing/firewall-3.png"><img alt="Windows cannot access error message" class="w250" src="../img/smb-file-sharing/firewall-3.png" /></a></p>
</li>
</ol>
</li>
<li>
<p>Ensure SMB2 is enabled</p>
<p>SMB version 2 (SMB2) is required for file sharing and is typically enabled by default.  The following command will ensure SMB2 is enabled and will have no effect if it is alread enabled.</p>
<p>Run this command from an <a href="#running-administrator-terminalprompt">Administrator PowerShell Terminal</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">Set-ItemProperty</span> <span class="n">-Path</span> <span class="s2">&quot;HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters&quot;</span> <span class="n">SMB2</span> <span class="n">-Value</span> <span class="n">1</span> <span class="n">-Force</span>
</code></pre></div>
</div>
<p>If the command runs successfully, no results will be displayed in the PowerShell terminal.</p>
</li>
<li>
<p>Verify all SMB configuration options</p>
<p>If you have completed all of the steps above and are still unable to use the SMB service, the following command will produce output that may be helpful in more exhaustive troubleshooting.</p>
<p>Run this command from an <a href="#running-administrator-terminalprompt">Administrator PowerShell Terminal</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">Get-SMBServerConfiguration</span>
</code></pre></div>
<details class="summary"><summary>Notional results</summary><div class="highlight"><pre><span></span><code><span class="gp">PS C:\Users\sansforensics&gt; </span><span class="nb">Get-SMBServerConfiguration</span>
<span class="go">AnnounceComment                 :</span>
<span class="go">AnnounceServer                  : False</span>
<span class="go">AsynchronousCredits             : 64</span>
<span class="go">AuditSmb1Access                 : False</span>
<span class="go">AutoDisconnectTimeout           : 15</span>
<span class="go">AutoShareServer                 : True</span>
<span class="go">AutoShareWorkstation            : True</span>
<span class="go">CachedOpenLimit                 : 10</span>
<span class="go">DurableHandleV2TimeoutInSeconds : 180</span>
<span class="go">EnableAuthenticateUserSharing   : True</span>
<span class="go">EnableDownlevelTimewarp         : False</span>
<span class="go">EnableForcedLogoff              : True</span>
<span class="go">EnableLeasing                   : True</span>
<span class="go">EnableMultiChannel              : True</span>
<span class="go">EnableOplocks                   : True</span>
<span class="go">EnableSecuritySignature         : False</span>
<span class="go">EnableSMB1Protocol              : True</span>
<span class="go">EnableSMB2Protocol              : True</span>
<span class="go">EnableStrictNameChecking        : True</span>
<span class="go">EncryptData                     : False</span>
<span class="go">IrpStackSize                    : 15</span>
<span class="go">KeepAliveTime                   : 2</span>
<span class="go">MaxChannelPerSession            : 32</span>
<span class="go">MaxMpxCount                     : 50</span>
<span class="go">MaxSessionPerConnection         : 16384</span>
<span class="go">MaxThreadsPerQueue              : 20</span>
<span class="go">MaxWorkItems                    : 1</span>
<span class="go">NullSessionPipes                :</span>
<span class="go">NullSessionShares               :</span>
<span class="go">OplockBreakWait                 : 35</span>
<span class="go">PendingClientTimeoutInSeconds   : 120</span>
<span class="go">RejectUnencryptedAccess         : True</span>
<span class="go">RequireSecuritySignature        : False</span>
<span class="go">ServerHidden                    : True</span>
<span class="go">Smb2CreditsMax                  : 2048</span>
<span class="go">Smb2CreditsMin                  : 128</span>
<span class="go">SmbServerNameHardeningLevel     : 0</span>
<span class="go">TreatHostAsStableStorage        : False</span>
<span class="go">ValidateAliasNotCircular        : True</span>
<span class="go">ValidateShareScope              : True</span>
<span class="go">ValidateShareScopeNotAliased    : True</span>
<span class="go">ValidateTargetName              : True</span>
</code></pre></div>
</details>
</div>
</li>
</ol>
<h2 id="running-administrator-terminalprompt">Running Administrator Terminal/Prompt</h2>
<p>The steps in this document may require either an Administrator PowerShell Terminal or a Windows Command Prompt.  To access these, use the following instructions.</p>
<ol>
<li>
<p>Administrator PowerShell Terminal
​​</p>
<ol>
<li>Right click the Windows Start Icon on the bottom left of your Task Bar.</li>
<li>
<p>Select Windows PowerShell (Admin) from the Menu.</p>
<p><a class="zoom" href="../img/smb-file-sharing/admin-powershell-launch.png"><img alt="Open Administrator PowerShell Terminal" class="w200" src="../img/smb-file-sharing/admin-powershell-launch.png" title="Open Administrator PowerShell Terminal" /></a></p>
</li>
<li>
<p>You may see a dialog requesting permission to make changes on your device.  Click <code>Yes</code>.</p>
<p><a class="zoom" href="../img/smb-file-sharing/admin-powershell-uac.png"><img alt="Administrator PowerShell Terminal UAC Dialog" class="w200" src="../img/smb-file-sharing/admin-powershell-uac.png" title="Administrator PowerShell Terminal UAC Dialog" /></a></p>
</li>
</ol>
</li>
<li>
<p>Administrator Command Prompt​
​</p>
<ol>
<li>Click the Windows search box or the Windows search icon (magnifying glass) on the bottom left of your Task Bar.</li>
<li>Type <code>cmd</code> in the search box.</li>
<li>
<p>Select <code>Run as Administrator</code>.</p>
<p><a class="zoom" href="../img/smb-file-sharing/admin-command-prompt-launch.png"><img alt="Open Administrator Command Prompt" class="w200" src="../img/smb-file-sharing/admin-command-prompt-launch.png" title="Open Administrator Command Prompt" /></a></p>
</li>
<li>
<p>You may see a dialog requesting permission to make changes on your device.  Click <code>Yes</code>.</p>
<p><a class="zoom" href="../img/smb-file-sharing/admin-command-prompt-uac.png"><img alt="Administrator Command Prompt UAC Dialog" class="w200" src="../img/smb-file-sharing/admin-command-prompt-uac.png" title="Administrator Command Prompt UAC Dialog" /></a></p>
</li>
</ol>
</li>
</ol>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../intel-amd-bios-vtx/" title="Enabling Virtualization Technology Extensions (VTx) in Intel and AMD BIOS" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Enabling Virtualization Technology Extensions (VTx) in Intel and AMD BIOS
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            ©2021 Jason Lam & Dr. Johannes Ullrich
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/jquery-3.4.1.min.js"></script>
      
        <script src="../../js/jquery.fancybox.min.js"></script>
      
        <script src="../../js/workbook.js"></script>
      
        <script src="../../js/custom.js"></script>
      
    
  </body>
</html>